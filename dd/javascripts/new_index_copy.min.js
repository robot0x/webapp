/*! diaodiao 李彦峰 2016-03-09 */
$(function(){var a=$(".wrapper"),b=a.find(".top-header"),c=b.height(),d=a.find(".header"),e=a.find(".banner-area");window.onscroll=function(){var a=document.body.scrollTop||document.documentElement.scrollTop;a>=c?(d.addClass("fixed"),e.css("margin-top",50)):(d.removeClass("fixed"),e.css("margin-top",0))};var f=$(".banner-list"),g=f.find("li"),h=g.css("margin-right"),i=g.width()+parseInt(h),j=g.length*i;f.css("width",j);var k=function(a){this.bannerArea=a.container,this.distance=a.width,this.bannerList=this.bannerArea.find(".banner-list"),this.list=$.makeArray(this.bannerList.children()),this.autoPlay=!0,this.hoverPausePlay=!0,this.direction=a.direction||"leftToRight","boolean"==typeof a.autoPlay&&(this.autoPlay=a.autoPlay),"boolean"==typeof a.hoverPausePlay&&(this.hoverPausePlay=a.hoverPausePlay),this.start()};k.prototype={constructor:k,bindEvent:function(){var a=this,b=a.distance,c=$(a.bannerList);a.bannerArea.on("click",".next",function(){var d=parseInt(c.css("left"));c.animate({left:d-b},function(){var b=a.list.shift();a.list.push(b),$(b).remove(),c.append(b),c.css("left",0)})}),a.bannerArea.on("click",".prev",function(){var d=(parseInt(c.css("left")),a.list.pop());a.list.unshift(d),$(d).remove(),$(a.list[1]).before(d),c.css("left",-b),c.animate({left:0})}),this.hoverPausePlay&&$(".banner-container,.prev,.next").hover(function(){a.stopPlay()},function(){a.play()})},start:function(){this.autoPlay&&this.play(),this.bindEvent()},stopPlay:function(){clearInterval(this.timer)},play:function(){var a=this;a.timer=setInterval(function(){"leftToRight"===a.direction?a.bannerArea.find(".next").trigger("click"):a.bannerArea.find(".prev").trigger("click")},2e3)}},new k({container:$(".banner-area"),width:i,direction:"leftToRight",autoPlay:!0,hoverPausePlay:!0});var l=function(a){this.countPerPage=a.countPerPage,this.totalCount=a.totalCount,this.displayPageCount=a.displayPageCount||7,this.appendTo=a.appendTo,this.data=a.data,this.currentIndex=1,null==this.totalCount&&this.data&&this.data.length>0&&(this.totalCount=this.data.length),this.start()};l.prototype={constructor:l,renderDOM:function(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("p"),d=document.createDocumentFragment(),e=Math.ceil(this.totalCount/this.countPerPage);if(!(1>=e)){a.className="pagination-container",b.className="pagination",c.className="pagination-main";var f=function(a){return a.href="javascript:void(0);",a.onclick="return false;",a},g=f(document.createElement("a")),h=g.cloneNode(!1);if(g.className="pagination-previous",g.innerHTML="上一页",h.className="pagination-next",h.innerHTML="下一页",d.appendChild(g),e<=this.displayPageCount-1)for(var i=0;e>i;i++){var j=f(document.createElement("a"));j.innerHTML=i+1,j.className="item",j.title=i+1,d.appendChild(j)}else{for(var i=0;i<this.displayPageCount-1;i++){var j=f(document.createElement("a"));j.innerHTML=i+1,j.className="item",j.title=i+1,d.appendChild(j)}var k=f(document.createElement("a"));k.innerHTML="...",k.className="more",d.appendChild(k);var l=f(document.createElement("a"));l.innerHTML=e,l.className="item",l.title=e,d.appendChild(l)}d.appendChild(h),c.appendChild(d),b.appendChild(c),a.appendChild(b),this.appendTo.appendChild(a),this.current(62)}},current:function(a){a=a||this.currentIndex;var b=this.appendTo.querySelector('.item[title="'+a+'"]');b&&(b.className=b.className+" current")},bindEvent:function(){{var a=this.appendTo.getElementsByClassName("pagination-previous")[0],b=this.appendTo.getElementsByClassName("pagination-next")[0];this.appendTo.getElementsByClassName("item")}a.onclick=function(){},console.log(a),console.log(b),this.appendTo.onclick=function(a){a=a||event;var b=a.target||a.srcElement;if("pagination-previous"===b.className)alert("上一页");else if("pagination-next"===b.className)alert("下一页");else if(-1!==b.className.indexOf("item")&&(alert("页码 "+b.innerHTML),-1!==b.className.indexOf("current")))return}},start:function(){this.renderDOM(),this.bindEvent()}};var m;$.ajax({url:"http://c.diaox2.com/cms/diaodiao/pcsite/goodthing_feed_list.json",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb",success:function(a){m=a;var b,c,d,e,f=a.goodthing_feed_list,g=document.getElementById("content-list"),h=document.createDocumentFragment(),i=0,j=f.length,k="http://www.diaox2.com/article/$1.html",n=/\/view\/app\/\?m=(?:show|zk|scene)&id=(\d+)?(&ch=goodthing)?/i,o=/\/cms\/diaodiao\/articles\/(?:goodthing|firstpage|experience|weekend)\/\d+_(\d+)?\.html/i;console.log(a);var p=24;for(console.log(j);p>i;)b=f[i++],null!=b&&(c=b.url,d=c.match(n),d&&d.length?c=d[0].replace(n,k):(d=c.match(o),d&&d.length&&(c=d[0].replace(o,k))),e=document.createElement("li"),e.innerHTML='<dl><dt class="loading"><a href="'+c+'" class="img-container" target="_blank"><img src="'+b.cover_image_url+'" width="390" height="254"></a></dt><dd><p><a href="'+b.url+'" target="_blank">'+b.title[0]+'</a></p><div class="icon-list clearfix"><img class="icon-clock" width="20" height="20" src="images/clock.png"><span class="date">一天前</span><a href="javascript:void(0);" target="_blank"><img class="icon-author" width="20" height="20" src="http://c.diaox2.com/cms/diaodiao/'+b.author.pic+'"></a></div></dd></dl>',h.appendChild(e));g.appendChild(h);new l({countPerPage:p,data:f,displayPageCount:7,appendTo:document.getElementById("content-area")})}})});