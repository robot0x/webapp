/*! diaodiao 李彦峰 2017-08-15 */
var Menu=function(a,b){this.el=a||{},this.$el=$(this.el),this.titleClssName="item-title",this.openClassName="open",this.activeClassName="active",this.datasetName="data-tid",this.multiple=b||!1,this.$submenuListItem=this.el.find(".submenu-list-item"),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(len=this.length;i<len&&a!==this[i];i++);return i===len?-1:i}),this.bindEvent()};Menu.prototype.dropdown=function(a){var b=a.data,c=b.multiple,d=b.self,e=b.$submenuListItem,f=b.el,g=$(this),h=f.find("."+d.titleClssName),i=h.index(g),j=f.data("oldIndex");$next=g.next(),$next.slideToggle(),g.parent().toggleClass(d.openClassName),h.eq(j).removeClass(d.activeClassName),e.each(function(a,b){$(b).removeClass(d.activeClassName)}),g.addClass(d.activeClassName),f.data("oldIndex",i),c||e.parent().not($next).slideUp().parent().removeClass(d.openClassName)},Menu.prototype.bindEvent=function(){var a=this.el.find("."+this.titleClssName),b=this;a.on("click",{el:this.el,self:b,multiple:b.multiple,$submenuListItem:b.$submenuListItem},b.dropdown),b.$submenuListItem.on("click",function(){b.$submenuListItem.each(function(a,c){$(c).removeClass(b.activeClassName)}),a.each(function(a,c){$(c).removeClass(b.activeClassName)}),$(this).toggleClass(b.activeClassName)})},Menu.prototype.getIdList=function(){var a,b=this.$el,c=b.find("."+this.titleClssName),d=[];return c.each(function(b,c){a=c.dataset?c.dataset.tid:c.getAttribute(this.datasetName),a&&-1===d.indexOf(a)&&d.push(a)}),this.$submenuListItem.each(function(b,c){a=c.dataset?c.dataset.tid:c.getAttribute(this.datasetName),a&&-1===d.indexOf(a)&&d.push(a)}),d},Menu.prototype.getIdListByOpen=function(a){var b=a.find("."+this.titleClssName),c=[b.attr(this.datasetName)],d=b.next().children();for(len=d.length,i=0;i<len;)c.push(d[i++].getAttribute("data-tid"));return c},Menu.prototype.closeAll=function(a){var b=this.$el,c=b.find("."+this.openClassName),d=this.getIdListByOpen(c);b.find("."+this.activeClassName).removeClass(this.activeClassName),c.removeClass(this.openClassName),-1==d.indexOf(a)&&c.find("."+this.titleClssName).next().slideUp()},Menu.prototype.openById=function(a){this.closeAll(a);var b=this.$el,c=b.find("["+this.datasetName+"="+a+"]"),d=b.find("."+this.titleClssName),e=c.parent();c.addClass(this.activeClassName),c.hasClass(this.titleClssName)?(e.addClass(this.openClassName),c.next().slideDown(),b.data("oldIndex",d.index(c))):(e.parent().addClass(this.openClassName),e.slideDown(),b.data("oldIndex",d.index(e.prev())))};