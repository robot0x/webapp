/*! diaodiao 李彦峰 2016-11-15 */
$.extend({getParam:function(){var a,b,c,d,e,f=window.location.href,g=f.split("?"),h={},i=0;if(g.length>1&&(c=g[1]),c)for(a=c.split("&"),b=a.length;b>i;i++)d=a[i],e=d.split("="),h[e[0]]=decodeURIComponent(e[1]);return h}}),$(function(){function a(){var a=[],b=$(".scene .cur-select,.relation .cur-select,.character .cur-select");b.each(function(b,c){a.push(c.innerHTML)}),console.log(a);for(var c=0,d=a.length,e=[];d>c;)e.push(s[a[c++]]);console.log(e);var f=[],g=e.reduce(function(a,b){return a.forEach(function(a){b.forEach(function(b){a===b&&f.push(a)})}),f});console.log(g)}function b(a){r=a;var b=(a.meta_infos,$(".goodthing-list"),a.gift_tag_index);$.extend(s,b.scene,b.relation,b.character),"礼物"!==h}function c(a){if(console.log("查询接口的jsonp执行成功！！"),a.count>0){var b,c,d,e,f,g,l,m=a.aids,n=a.meta_infos,o="",p=$(".result-list");$.each(m,function(a,m){b=n[m],e=o="",b.price||(b.price="<img width='15' height='15' style='margin-right:5px;' src='http://c.diaox2.com/cms/diaodiao/assets/links.png'>全网结果"),c=b.rendered_keywords,$.each(c,function(a,b){o+=0==a&&b[0]==h?'<li class="f-l"><span class="target-word">'+b[0]+"</span></li>":'<li class="f-l">'+b[0]+"</li>"}),d=b.rendered_title,l=b.thumb_image_url,-1==l.indexOf("http")&&(l="http://a.diaox2.com/cms/sites/default/files/"+l),e=b.author.src||b.author.url,-1==e.indexOf("http")&&(e="editor/"+e+".html"),d=d.replace(/<<<<(.*?)>>>>/gi,"<span class='target-word'>$1</span>"),f=b.url,g=f.match(i),g&&g.length?f=g[0].replace(i,k):(g=f.match(j),g&&g.length&&(f=g[0].replace(j,k)));var q=b.price;(b.has_buylink===!1||"N/A"===b.price)&&(q="&nbsp"),$('<li class="result-item" data-pos='+(a+1)+'><a target="_blank" href="http://www.diaox2.com/'+f+'" class="imglink f-l"><div class="result-item-img-container loading"><img src="'+l+'" alt="'+c+'" width="188" height="188"></div></a><div class="result-item-detail f-l"><h2 class="detail-title"><a target="_blank" href="'+f+'">'+d+'</a></h2><ul class="detail-keywords clearfix">'+o+'</ul><div class="detail-author clearfix"><a class="detail f-l">'+q+'</a><div class="author f-l clearfix"><ul class="clearfix"><li class="author-face f-l"><a target="_blank" href="'+e+'"><span class="author-face-container"><img src="http://c.diaox2.com/cms/diaodiao/'+b.author.pic+'" width="20" height="20"></span></a></li><li class="author-name f-l"><a target="_blank" href="'+e+'">'+b.author.name+"</a></li></ul></div></div></div></li>").appendTo(p)})}else $(".no-result").find(".target-word").html("“"+(void 0==h?"":h)+"”"),$(".no-result").addClass("disblk");var q=$(".result-item"),f=(q.attr("data-pos"),q.find(".imglink ").attr("href"));q.on("click","a.imglink,.detail-title a",function(a){var b=a.delegateTarget,c=this.href,d=b.getAttribute("data-pos"),e=window.location.href,f=localStorage,g=JSON.parse(f.getItem("statisticsData")),i=g.click_data.search,j=0,k=i.length;if(-1!==e.indexOf("&t=h"))for(;k>j;j++){var l=i[j];if(l.query===h&&"pc_hotQueries"===l.from){var m=l.click,n={url:c,pos:d};m.push(n)}}else for(;k>j;j++){var l=i[j];if(l.query===h){var m=l.click,n={url:c,pos:d};m.push(n)}}f.setItem("statisticsData",JSON.stringify(g))})}var d,e=$.getParam(),f=document.querySelector(".hot-search-word-list"),g=$(f),h=$.getParam().q,i=/\/view\/app\/\?m=(?:show|zk|scene)&id=(\d+)?(&ch=goodthing)?/i,j=/\/cms\/diaodiao\/articles\/(?:goodthing|firstpage|experience|weekend)\/\d+_(\d+)?\.html/i,k="article/$1.html",e=$.getParam(),l=-1!==h.indexOf("礼物"),m=function(a,b){return a.sort(function(){return Math.random()-.5}),a.slice(0,b)};if(e&&e.q&&(document.title=e.q+"_"+document.title,$("#search-input").val(e.q)),l){$(".hot-search").hide(),$(".present-area").css("display","block"),$.ajax({url:"http://s.diaox2.com/view/app/gift_supply.php",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb4",cache:!0,timeout:8e4,error:function(a){console.log("搜索接口的jsonp执行失败！！ "+a)},success:b});var n,o,p,q,r,s={};$(document).on("click",".present-type li",function(){q=$(this),p=q.parent().parent(),p.hasClass("scene")?(n&&n.removeClass("cur-select"),q.addClass("cur-select"),n=q):p.hasClass("relation")?(o&&o.removeClass("cur-select"),q.addClass("cur-select"),o=q):(p.hasClass("character")||p.hasClass("price"))&&q.toggleClass("cur-select"),a()})}else $(".hot-search").show(),$(".present-area").css("display","none"),$.ajax({url:"http://api.diaox2.com/v2/app/config",dataType:"jsonp",type:"GET",jsonp:"cb",jsonpCallback:"cb3",error:function(a){console.log("热搜词接口的jsonp执行失败！！"),console.log(a)},success:function(a){console.log("热搜词接口的jsonp执行成功！！"),d=a.res.search.hot_slide_search_word,d=m(d,5),$.each(d,function(a,b){$('<li class="hot-search-word f-l"><a href="'+window.location.href.split("?")[0]+"?q="+b+'&t=h">'+b+"</a></li>").appendTo(g)})}}),$.ajax({url:"http://s.diaox2.com/ddsearch/q",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb2",cache:!0,timeout:2e4,data:{data:JSON.stringify({query:h,from:"pc"})},error:function(a){console.log("搜索接口的jsonp执行失败！！ "+a)},success:c});$.ajax({url:"http://c.diaox2.com/cms/diaodiao/pcsite/zk_feed_list.json",type:"GET",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb",timeout:2e4,error:function(a){console.log("获取热门专题接口的jsonp执行失败！！"),console.log(a)},success:function(a){console.log("获取热门专题接口的jsonp执行成功！！");var b,c=a.goodthing_feed_list,d=$(".special");$.each(c,function(a,c){if(!(a>1)){b=c.url,match=b.match(i),match&&match.length?b=match[0].replace(i,k):(match=b.match(j),match&&match.length&&(b=match[0].replace(j,k)));var e=c.title,f=0,g=c.title.length,h=titleStr2="";if(2===g)h=e[0],titleStr2=e[1];else{for(;g-1>f;f++)h=h+e[f]+"<br>";titleStr2=e[g-1]}$('<li class="loading"><a target="_blank" href="'+b+'"><img src="'+c.cover_image_url+'" alt="'+h.replace("<br>","")+'" width="277" height="180"><p>'+h+"</p><span>"+titleStr2+'</span><div class="black-musk"></div></a></li>').appendTo(d)}})}});var t,u=window.location.href,v=localStorage,w=v.getItem("statisticsData"),x=w?JSON.parse(w):{};w||(x.method="log_search_click",x.click_data={did:"",search:[]}),t=-1!==u.indexOf("&t=h")?"pc_hotQueries":"pc_searchResult";var y=x.click_data.search,z={query:h,from:t,click:[]};y.push(z),v.setItem("statisticsData",JSON.stringify(x));var A=v.getItem("statisticsData");window.onbeforeunload=function(){A&&$.ajax({url:"http://api.diaox2.com/v2/ubs",type:"POST",async:!1,contentType:"application/json",data:A,success:function(a){localStorage.clear(),localStorage.setItem("word:"+h,JSON.stringify(a))},error:function(a,b){localStorage.setItem("error_info",b),localStorage.setItem("error_info_status",a.status)}})},document.getElementById("search-input").value=document.getElementById("search-input").value.replace(/\+/g," ")});