/*! diaodiao 李彦峰 2016-03-09 */
function htmlwork(a,b){if(void 0==b)return!1;void 0==a&&(a="#relcardlast");var c="";return c+='<div class="articlecard" data-href="'+b.url+'">\n',c+=b.thumb_image_url.match(/^https?:\/\//i)?'<img class="articleimg" src="'+b.thumb_image_url+'" />':'<img class="articleimg" src="http://a.diaox2.com/cms/sites/default/files/'+b.thumb_image_url+'" />',c+='<span class="articletitle">'+b.title.join("")+"</span>\n",c+='<span class="articleread unknown" data-id="'+b.cid+'">阅读&nbsp;...</span>',c+='\n</div><hr class="articlesep">\n',$(c).insertBefore(a),bind_log_click(".articlecard:last","data-href","authorrel"),!0}function getmore(){console.log("reached bottom by num:"+nowpos),allarticles.length>nowpos&&(0==$(".loading_bar").length||void 0==$(".loading_bar"))&&$('<div class="loading_bar" align="center"><img src="/cms/diaodiao/assets/progress.gif" /></div>').insertBefore("div.bottomspace");for(var a=0,b=allarticles.length,c=[];20>a&&b>nowpos;a++,nowpos++)c.push(allarticles[nowpos]);if(0!=a){jQuery.support.cors=!0;var d={request_methods:["specified_meta_data"],request_data:{specified_meta_data:{cids:c}}};$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify(d),dataType:"json",url:"http://api.diaox2.com/v2/meta",success:function(b){if("SUCCESS"!=b.state)return nowpos-=a,!1;for(var c=b.res.specified_meta_data.meta_infos,d=0;d<c.length;d++)htmlwork("#relcardlast",c[d]);update_read(".articleread.unknown",update_callback)},timeout:8e4,error:function(){console.log("get more meta error! rewind"),nowpos-=a}})}}function update_callback(a){void 0==a&&(a=".articleread"),console.log("update_callback, called on selector:"+a),0!=$(".loading_bar").length&&$(".loading_bar").remove(),$(a).addClass("known"),$(a).removeClass("unknown"),$("#relcardlast").waypoint(getmore,{offset:"bottom-in-view",triggerOnce:!0})}allarticles=[0xf5300000f53,0xed100000ed1,0xd1d00000d1d,4677219386433,0xd4c00000d4c,0xd0400000d04,0xc0e00000c0e,0xa2f00000a2f,0xa2200000a22,0x92900000929,9573482105013,9221294786659,9225589753956,3972844749725,3783866188657,4393751544831,3517578216243,3178275799780,2362232013350,2044404433372,1636382540157,1640677507454,639950127253],nowpos=20,$(document).ready(function(){var a=$.cookie("DDuid");void 0==a&&(a=-1),add_access({action:"navigate",value:"Tag",user:a},"log"),bind_log_click(".articlecard","data-href","tagrelcard"),update_read(".articleread",update_callback)});