$.extend({getParam:function(){var a,b,c,d,e,f=window.location.href,g=f.split("?"),h={},i=0;if(g.length>1&&(c=g[1]),c)for(a=c.split("&"),b=a.length;b>i;i++)d=a[i],e=d.split("="),h[e[0]]=decodeURIComponent(e[1]);return h}}),$(function(){function a(a){var b=document.createElement("b");return b.innerHTML="<!--[if IE "+a+"]><i></i><![end if]-->",1===b.getElementsByTagName("i").length}function b(){G=$(this);var a=this.getAttribute("data-group");if("scene"===a){if(E&&(E.removeClass("cur-select"),E.attr("data-title")===G.attr("data-title")))return E=void 0,void c();G.addClass("cur-select"),E=G}else if("relation"===a){if(F&&(F.removeClass("cur-select"),F.attr("data-title")===G.attr("data-title")))return F=void 0,void c();G.addClass("cur-select"),F=G}else("character"===a||"price"===a)&&(console.log(a),G.toggleClass("cur-select"));c()}function c(){var a=d(),b=H.meta_infos,c={};if(a&&a.length)a.forEach(function(a){b[a]&&(c[a]=b[a])}),$(".no-result").hide(),$(".no-result p.f-l").html('找不到<span class="target-word"></span>，换个关键词试试'),g(c);else{var e=document.querySelectorAll(".cur-select");e.length?(document.getElementById("goodthing-list").innerHTML="",$(".no-result").show(),$(".no-result p.f-l").text("没有结果，换个组合试试"),n("none")):g(b)}}function d(){var a,b,c=$(".scene .cur-select,.relation .cur-select,.character .cur-select"),d=$(".price .cur-select"),e=[],g=[],h=[],i=[],j=[],k=[];return c.each(function(a,b){"character"===b.getAttribute("data-group")?g.push(b.getAttribute("data-title")):h.push(b.getAttribute("data-title"))}),g.length&&(i=[],g.forEach(function(a){i.push(J[a])}),j.push(1===i.length?i[0]:i.reduce(function(a,b){return a.concat(b)}).unique())),d.length&&d.each(function(a,b){e.push(b.getAttribute("data-title"))}),e.length&&(a=f(e),j.push(a)),h.forEach(function(a){j.push(J[a])}),j.length&&(b=j.reduce(function(a,b){return a.forEach(function(a){b.forEach(function(b){a===b&&k.push(a)})}),k})),b}function e(a){if(null==a)return!0;for(var b in a)return!1;return!0}function f(a){var b,c,d,e,f,g=/\d+((\.|,)\d+)?/g,h=[],i=H.meta_infos;return a.forEach(function(a){b=a.split("-");for(d in i)d=+d,e=i[d],c=e.has_buylink,f=e.price,c&&f&&(f=f.match(g),f&&f.length&&(f=f[0],-1!==f.indexOf(",")&&(f=f.split(",").join("")),f=parseFloat(f)),f>=b[0]&&(b[1]?f<b[1]&&-1===h.indexOf(d)&&h.push(d):-1===h.indexOf(d)&&h.push(d)))}),h}function g(a){var b,c,d,e,f,g=document.getElementById("goodthing-list"),h=[];gift_tag_index=Q.gift_tag_index,count=0,g.innerHTML="";for(b in a){if(b=+b,count++>=I)break;K||(K=a),everyMeta=a[b],everyMeta&&(c=everyMeta.cover_image_url,d=everyMeta.rendered_title,f=everyMeta.price,everyMeta.has_buylink&&null!=f&&"N/A"!==f||(f="&nbsp"),e=everyMeta.url,e&&(match=e.match(x),match&&match.length?e=match[0].replace(x,z):(match=e.match(y),match&&match.length&&(e=match[0].replace(y,z)))),c&&-1==c.indexOf("http")&&(c="http://a.diaox2.com/cms/sites/default/files/"+c),h.push('<li class="goodthing" data-pos='+L++ +'><a href="',w,e,'" target="_blank"><div class="img-container"><img src="',c,'" alt="',d,'" onload="adjust(this)"></div><div class="goodthing-highlight"><h2><div>',d,'</div></h2><ul class="icon-list clearfix unknown" data-id=',Math.pow(2,32)*b+b,'><li class="icon-item f-l"><span>',f,'</span></li><li class="icon-item f-r"><i class="icon icon-s"></i><span class="a-fav">...</span></li><li class="icon-item f-r"><i class="icon icon-z"></i><span class="a-up">...</span></li></ul></div></a></li>'),delete a[b])}K=a,document.getElementById("goodthing-list").innerHTML=h.join(""),j(),$(g).on("click","li a",function(){var a,b,c,d=this.parentNode,e=this.href,f=d.getAttribute("data-pos"),g=window.location.href,h=localStorage,i=JSON.parse(h.getItem("statisticsData")),j=i.click_data.search,k=0,l=j.length;if(console.log(d),-1!==g.indexOf("&t=h"))for(;l>k;k++)a=j[k],a.query===v&&"pc_hotQueries"===a.from&&(b=a.click,c={url:e,pos:f},b.push(c));else for(;l>k;k++)a=j[k],a.query===v&&(b=a.click,c={url:e,pos:f},b.push(c));h.setItem("statisticsData",JSON.stringify(i))})}function h(a){jQuery.support.cors=!0,$.ajax({url:"http://api.diaox2.com/v1/stat/all",data:{data:JSON.stringify({aids:a})},dataType:"jsonp",type:"GET",jsonp:"cb",jsonpCallback:"cb5",timeout:8e3,success:i,error:function(a,b,c){console.log("update failed, with error "+c)}})}function i(a){if("SUCCESS"!=a.result)return console.log("update invoked but server fail."),!1;{var b,c,d,e,f=$(".unknown");f.elements}for(b in a.res)for(c=0;c<f.length;c++)d=$(f[c]),b==d.attr("data-id")&&(e=a.res[b],d.find(".a-fav").text(e.fav),d.find(".a-up").text(e.up),d.addClass("known").removeClass("unknown"));return!0}function j(){for(var a,b,c=$(".unknown"),d=[],e=0,f=c.length;f>e;)a=$(c[e++]),b=a.attr("data-id"),isNaN(b)||d.push(+b);return function(a){!function(){var b=a.slice(0,I);return a=a.slice(I),b.length>0?(h(b),void setTimeout(arguments.callee,2e3)):!0}()}(d),!0}function k(){var a=v.split("+").join(""),c=Array.prototype.slice.call(document.querySelectorAll(".present-type li"));c.forEach(function(c){-1!==a.indexOf(c.innerHTML)&&b.call(c)})}function l(a){H=a;var b=a.gift_tag_index;return $.extend(J,b.scene,b.relation,b.character),"礼物"!==v?void k():void g(a.meta_infos)}function m(a){if(a.count>0){var b,c,d,e,f,g,h,i=a.aids,j=a.meta_infos,k="",l=[];$.each(i,function(a,i){b=j[i],e=k="",b.price||(b.price="<img width='15' height='15' style='margin-right:5px;' src='http://c.diaox2.com/cms/diaodiao/assets/links.png'>全网结果"),c=b.rendered_keywords,$.each(c,function(a,b){k+=0==a&&b[0]==v?'<li class="f-l"><span class="target-word">'+b[0]+"</span></li>":'<li class="f-l">'+b[0]+"</li>"}),d=b.rendered_title,h=b.thumb_image_url,-1==h.indexOf("http")&&(h="http://a.diaox2.com/cms/sites/default/files/"+h),e=b.author.src||b.author.url,-1==e.indexOf("http")&&(e="editor/"+e+".html"),d=d.replace(/<<<<(.*?)>>>>/gi,"<span class='target-word'>$1</span>"),f=b.url,g=f.match(x),g&&g.length?f=g[0].replace(x,z):(g=f.match(y),g&&g.length&&(f=g[0].replace(y,z)));var m=b.price;(b.has_buylink===!1||"N/A"===b.price)&&(m="&nbsp"),l.push('<li class="result-item" data-pos=',a+1,'><a target="_blank" href="',w,f,'" class="imglink f-l"><div class="result-item-img-container loading"><img src="',h,'" alt="',c,'" width="188" height="188"></div></a><div class="result-item-detail f-l"><h2 class="detail-title"><a target="_blank" href="',f,'">',d,'</a></h2><ul class="detail-keywords clearfix">',k,'</ul><div class="detail-author clearfix"><a class="detail f-l">',m,'</a><div class="author f-l clearfix"><ul class="clearfix"><li class="author-face f-l"><a target="_blank" href="',e,'"><span class="author-face-container"><img src="http://c.diaox2.com/cms/diaodiao/',b.author.pic,'" width="20" height="20"></span></a></li><li class="author-name f-l"><a target="_blank" href="',e,'">',b.author.name,"</a></li></ul></div></div></div></li>")}),document.getElementById("result-list").innerHTML=l.join("")}else $(".no-result").find(".target-word").html("“"+(void 0==v?"":v)+"”"),$(".no-result").addClass("disblk");var m=$(".result-item"),f=(m.attr("data-pos"),m.find(".imglink ").attr("href"));m.on("click","a.imglink,.detail-title a",function(a){var b,c,d,e=a.delegateTarget,f=this.href,g=e.getAttribute("data-pos"),h=window.location.href,i=localStorage,j=JSON.parse(i.getItem("statisticsData")),k=j.click_data.search,l=0,m=k.length;if(console.log(e),-1!==h.indexOf("&t=h"))for(;m>l;l++)b=k[l],b.query===v&&"pc_hotQueries"===b.from&&(c=b.click,d={url:f,pos:g},c.push(d));else for(;m>l;l++)b=k[l],b.query===v&&(c=b.click,d={url:f,pos:g},c.push(d));i.setItem("statisticsData",JSON.stringify(j))})}function n(a){var b=document.querySelector(".rectangle-bounce");b&&(b.style.display=a)}function o(){if(e(K))return void n("none");var a,b,c,d,f,g,h,i,k,l,m,o=document.getElementById("goodthing-list"),p=o.querySelector(".goodthing"),q=document.createDocumentFragment(),r=(Q.gift_tag_index,0);for(a in K){if(!a||isNaN(a)||r++>=I)break;g=p.cloneNode(!0),h=g.querySelector("a"),i=h.querySelector(".img-container img"),k=h.querySelector(".goodthing-highlight h2 div"),m=h.querySelector(".icon-list"),l=m.querySelector(".f-l span"),everyMeta=K[a],everyMeta&&(b=everyMeta.cover_image_url,c=everyMeta.rendered_title,f=everyMeta.price,everyMeta.has_buylink&&null!=f&&"N/A"!==f||(f="&nbsp"),d=everyMeta.url,d&&(match=d.match(x),match&&match.length?d=match[0].replace(x,z):(match=d.match(y),match&&match.length&&(d=match[0].replace(y,z)))),b&&-1==b.indexOf("http")&&(b="http://a.diaox2.com/cms/sites/default/files/"+b),i.removeAttribute("width"),i.removeAttribute("height"),i.removeAttribute("style"),g.setAttribute("data-pos",L++),h.href=w+d,i.src=b,i.alt=c,m.className="icon-list clearfix unknown",m.setAttribute("data-id",Math.pow(2,32)*a+ +a),k.innerHTML=c,l.innerHTML=f,q.appendChild(g)),delete K[a]}o.appendChild(q),j()}function p(a,b,c){clearTimeout(a.tId),a.tId=setTimeout(function(){a.call(b)},c)}function q(a,b,c){var d=a["on"+b];a["on"+b]=d?function(){d(),c()}:c}var r,s=$.getParam(),t=document.querySelector(".hot-search-word-list"),u=$(t),v=$.getParam().q,w="",x=/\/view\/app\/\?m=(?:show|zk|scene)&id=(\d+)?(&ch=goodthing)?/i,y=/\/cms\/diaodiao\/articles\/(?:goodthing|firstpage|experience|weekend)\/\d+_(\d+)?\.html/i,z="article/$1.html",s=$.getParam(),A=-1!==v.indexOf("礼物"),B=function(a,b){return a.sort(function(){return Math.random()-.5}),a.slice(0,b)};if(s&&s.q&&(document.title=s.q+"_"+document.title,$("#search-input").val(s.q)),A){if(Array.prototype.unique=function(){for(var a={},b=[],c=0,d=this.length;d>c;c++)a[this[c]]||(a[this[c]]=!0,b.push(this[c]));return b},"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(a){for(var b=0,c=this.length;c>b;)a(this[b],b++)}),"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(a,b){var c=b,d=0,e=this.length;if("undefined"==typeof b&&(c=this[0],d=1),"function"==typeof a)for(d;e>d;d++)this.hasOwnProperty(d)&&(c=a(c,this[d],d,this));return c}),"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(a){for(var b=0,c=this.length;c>b&&a!==this[b];b++);return b===c?-1:b}),a(9)){var C=document.querySelector(".present-result"),D=document.createElement("div");C.removeChild(C.querySelector(".rectangle-bounce")),D.innerHTML="正在加载...",D.className="IE9LOADING",C.appendChild(D)}$(".hot-search").hide(),$(".present-area").css("display","block"),$.ajax({url:"http://s.diaox2.com/view/app/gift_supply.php",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb4",cache:!0,timeout:1e5,success:l});var E,F,C,G,H,I=20,J={};$(document).on("click",".present-type li",function(){p(b,this,300)})}else $(".hot-search").show(),$(".present-area").css("display","none"),$.ajax({url:"http://api.diaox2.com/v2/app/config",dataType:"jsonp",type:"GET",jsonp:"cb",jsonpCallback:"cb3",success:function(a){r=a.res.search.hot_slide_search_word,r=B(r,5),$.each(r,function(a,b){$('<li class="hot-search-word f-l"><a href="'+window.location.href.split("?")[0]+"?q="+b+'&t=h">'+b+"</a></li>").appendTo(u)})}}),$.ajax({url:"http://s.diaox2.com/ddsearch/q",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb2",cache:!0,timeout:2e4,data:{data:JSON.stringify({query:v,from:"pc"})},success:m});var K,L=1;$.ajax({url:"http://c.diaox2.com/cms/diaodiao/pcsite/zk_feed_list.json",type:"GET",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb",timeout:2e4,success:function(a){var b,c,d=a.goodthing_feed_list,c=[];$.each(d,function(a,d){if(!(a>1)){b=d.url,match=b.match(x),match&&match.length?b=match[0].replace(x,z):(match=b.match(y),match&&match.length&&(b=match[0].replace(y,z)));var e=d.title,f=0,g=d.title.length,h=titleStr2="";if(2===g)h=e[0],titleStr2=e[1];else{for(;g-1>f;f++)h=h+e[f]+"<br>";titleStr2=e[g-1]}c.push('<li class="loading"><a target="_blank" href="',b,'"><img src="',d.cover_image_url,'" alt="',h.replace("<br>",""),'" width="277" height="180"><p>',h,"</p><span>",titleStr2,'</span><div class="black-musk"></div></a></li>')}}),document.getElementById("special").innerHTML=c.join("")}});var M,N=window.location.href,O=localStorage,P=O.getItem("statisticsData"),Q=P?JSON.parse(P):{};P||(Q.method="log_search_click",Q.click_data={did:"",search:[]}),M=-1!==N.indexOf("&t=h")?"pc_hotQueries":"pc_searchResult";var R=Q.click_data.search,S={query:v,from:M,click:[]};R.push(S),O.setItem("statisticsData",JSON.stringify(Q));var T=O.getItem("statisticsData");window.onbeforeunload=function(){T&&$.ajax({url:"http://api.diaox2.com/v2/ubs",type:"POST",async:!1,contentType:"application/json",data:T,success:function(a){localStorage.clear(),localStorage.setItem("word:"+v,JSON.stringify(a))},error:function(a,b){localStorage.setItem("error_info",b),localStorage.setItem("error_info_status",a.status)}})},document.getElementById("search-input").value=document.getElementById("search-input").value.replace(/\+/g," "),A&&q(window,"scroll",function(){if(document.querySelector(".goodthing")){var b=document.body.clientHeight,c=document.documentElement.offsetHeight,d=document.documentElement.scrollTop||document.body.scrollTop,e=d+c;a(9)||a(8)?Math.abs(e-b)<=150&&p(o,window,700):d+c===b&&(p(o,window,700),n("block"))}})});