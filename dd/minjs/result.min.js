/*! diaodiao 李彦峰 2015-10-17 */
$.extend({getParam:function(){var a,b,c,d,e,f=window.location.href,g=f.split("?"),h={},i=0;if(g.length>1&&(c=g[1]),c)for(a=c.split("&"),b=a.length;b>i;i++)d=a[i],e=d.split("="),h[e[0]]=decodeURIComponent(e[1]);return h}}),$(function(){function a(a){var b,c,d,e,f,g=a.meta_infos,k=$(".goodthing-list");for(b in g)everyMeta=g[b],c=everyMeta.cover_image_url,d=everyMeta.rendered_title,f=everyMeta.price,(everyMeta.has_buylink===!1||"N/A"===everyMeta.price)&&(f="&nbsp"),e=everyMeta.url,match=e.match(h),match&&match.length?e=match[0].replace(h,j):(match=e.match(i),match&&match.length&&(e=match[0].replace(i,j))),-1==c.indexOf("http")&&(c="http://a.diaox2.com/cms/sites/default/files/"+c),$('<li class="goodthing"><a href="http://www.diaox2.com/'+e+'" target="_blank"><div class="img-container"><img src="'+c+'" alt="'+d+'" onload="adjust(this)"></div><div class="goodthing-highlight"><h2><div>'+d+'</div></h2><ul class="icon-list clearfix"><li class="icon-item f-l"><span>'+f+'</span></li><li class="icon-item f-r"><i class="icon icon-s"></i><span>132</span></li><li class="icon-item f-r"><i class="icon icon-z"></i><span>123</span></li></ul></div></a></li>').appendTo(k)}function b(a){if(console.log("查询接口的jsonp执行成功！！"),a.count>0){var b,c,d,e,f,k,l,m=a.aids,n=a.meta_infos,o="",p=$(".result-list");$.each(m,function(a,m){b=n[m],e=o="",b.price||(b.price="<img width='15' height='15' style='margin-right:5px;' src='http://c.diaox2.com/cms/diaodiao/assets/links.png'>全网结果"),c=b.rendered_keywords,$.each(c,function(a,b){o+=0==a&&b[0]==g?'<li class="f-l"><span class="target-word">'+b[0]+"</span></li>":'<li class="f-l">'+b[0]+"</li>"}),d=b.rendered_title,l=b.thumb_image_url,-1==l.indexOf("http")&&(l="http://a.diaox2.com/cms/sites/default/files/"+l),e=b.author.src||b.author.url,-1==e.indexOf("http")&&(e="editor/"+e+".html"),d=d.replace(/<<<<(.*?)>>>>/gi,"<span class='target-word'>$1</span>"),f=b.url,k=f.match(h),k&&k.length?f=k[0].replace(h,j):(k=f.match(i),k&&k.length&&(f=k[0].replace(i,j)));var q=b.price;(b.has_buylink===!1||"N/A"===b.price)&&(q="&nbsp"),$('<li class="result-item" data-pos='+(a+1)+'><a target="_blank" href="http://www.diaox2.com/'+f+'" class="imglink f-l"><div class="result-item-img-container loading"><img src="'+l+'" alt="'+c+'" width="188" height="188"></div></a><div class="result-item-detail f-l"><h2 class="detail-title"><a target="_blank" href="'+f+'">'+d+'</a></h2><ul class="detail-keywords clearfix">'+o+'</ul><div class="detail-author clearfix"><a class="detail f-l">'+q+'</a><div class="author f-l clearfix"><ul class="clearfix"><li class="author-face f-l"><a target="_blank" href="'+e+'"><span class="author-face-container"><img src="http://c.diaox2.com/cms/diaodiao/'+b.author.pic+'" width="20" height="20"></span></a></li><li class="author-name f-l"><a target="_blank" href="'+e+'">'+b.author.name+"</a></li></ul></div></div></div></li>").appendTo(p)})}else $(".no-result").find(".target-word").html("“"+(void 0==g?"":g)+"”"),$(".no-result").addClass("disblk");var q=$(".result-item"),f=(q.attr("data-pos"),q.find(".imglink ").attr("href"));q.on("click","a.imglink,.detail-title a",function(a){var b=a.delegateTarget,c=this.href,d=b.getAttribute("data-pos"),e=window.location.href,f=localStorage,h=JSON.parse(f.getItem("statisticsData")),i=h.click_data.search,j=0,k=i.length;if(-1!==e.indexOf("&t=h"))for(;k>j;j++){var l=i[j];if(l.query===g&&"pc_hotQueries"===l.from){var m=l.click,n={url:c,pos:d};m.push(n)}}else for(;k>j;j++){var l=i[j];if(l.query===g){var m=l.click,n={url:c,pos:d};m.push(n)}}f.setItem("statisticsData",JSON.stringify(h))})}var c,d=$.getParam(),e=document.querySelector(".hot-search-word-list"),f=$(e),g=$.getParam().q,h=/\/view\/app\/\?m=(?:show|zk|scene)&id=(\d+)?(&ch=goodthing)?/i,i=/\/cms\/diaodiao\/articles\/(?:goodthing|firstpage|experience|weekend)\/\d+_(\d+)?\.html/i,j="article/$1.html",d=$.getParam(),k=-1!==g.indexOf("礼物"),l=function(a,b){return a.sort(function(){return Math.random()-.5}),a.slice(0,b)};if(d&&d.q&&(document.title=d.q+"_"+document.title,$("#search-input").val(d.q)),k){$(".hot-search").hide(),$(".present-area").css("display","block"),$.ajax({url:"http://s.diaox2.com/view/app/gift_supply.php",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb4",cache:!0,timeout:8e4,error:function(a){console.log("搜索接口的jsonp执行失败！！ "+a)},success:a});var m=$(".present-type li");m.each(function(a,b){var c=$(b.parentNode.parentNode),d=b.innerHTML,e=$(b);if(-1!==g.indexOf(d))if(c.hasClass("scene")||c.hasClass("relation")){if($parent.hasClass("has"))return;$parent.addClass("has"),e.addClass("cur-select")}else e.addClass("cur-select")})}else $(".hot-search").show(),$(".present-area").css("display","none"),$.ajax({url:"http://api.diaox2.com/v2/app/config",dataType:"jsonp",type:"GET",jsonp:"cb",jsonpCallback:"cb3",error:function(a){console.log("热搜词接口的jsonp执行失败！！"),console.log(a)},success:function(a){console.log("热搜词接口的jsonp执行成功！！"),c=a.res.search.hot_slide_search_word,c=l(c,5),$.each(c,function(a,b){$('<li class="hot-search-word f-l"><a href="'+window.location.href.split("?")[0]+"?q="+b+'&t=h">'+b+"</a></li>").appendTo(f)})}}),$.ajax({url:"http://s.diaox2.com/ddsearch/q",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb2",cache:!0,timeout:2e4,data:{data:JSON.stringify({query:g,from:"pc"})},error:function(a){console.log("搜索接口的jsonp执行失败！！ "+a)},success:b});$.ajax({url:"http://c.diaox2.com/cms/diaodiao/pcsite/zk_feed_list.json",type:"GET",dataType:"jsonp",jsonp:"cb",jsonpCallback:"cb",timeout:2e4,error:function(a){console.log("获取热门专题接口的jsonp执行失败！！"),console.log(a)},success:function(a){console.log("获取热门专题接口的jsonp执行成功！！");var b,c=a.goodthing_feed_list,d=$(".special");$.each(c,function(a,c){if(!(a>1)){b=c.url,match=b.match(h),match&&match.length?b=match[0].replace(h,j):(match=b.match(i),match&&match.length&&(b=match[0].replace(i,j)));var e=c.title,f=0,g=c.title.length,k=titleStr2="";if(2===g)k=e[0],titleStr2=e[1];else{for(;g-1>f;f++)k=k+e[f]+"<br>";titleStr2=e[g-1]}$('<li class="loading"><a target="_blank" href="'+b+'"><img src="'+c.cover_image_url+'" alt="'+k.replace("<br>","")+'" width="277" height="180"><p>'+k+"</p><span>"+titleStr2+'</span><div class="black-musk"></div></a></li>').appendTo(d)}})}});var n,o=window.location.href,p=localStorage,q=p.getItem("statisticsData"),r=q?JSON.parse(q):{};q||(r.method="log_search_click",r.click_data={did:"",search:[]}),n=-1!==o.indexOf("&t=h")?"pc_hotQueries":"pc_searchResult";var s=r.click_data.search,t={query:g,from:n,click:[]};s.push(t),p.setItem("statisticsData",JSON.stringify(r));var u=p.getItem("statisticsData");window.onbeforeunload=function(){u&&$.ajax({url:"http://api.diaox2.com/v2/ubs",type:"POST",async:!1,contentType:"application/json",data:u,success:function(a){localStorage.clear(),localStorage.setItem("word:"+g,JSON.stringify(a))},error:function(a,b){localStorage.setItem("error_info",b),localStorage.setItem("error_info_status",a.status)}})},document.getElementById("search-input").value=document.getElementById("search-input").value.replace(/\+/g," ")});